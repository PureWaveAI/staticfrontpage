# user  nginx;
worker_processes  auto;

# Set error log level to debug for detailed diagnostics
error_log  /var/log/nginx/error.log debug;
pid        /var/run/nginx.pid;

events {
    worker_connections 1024;
}

http {
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;

    # Simple access log (use nginx default format)
    access_log  /var/log/nginx/access.log;

    sendfile        on;
    keepalive_timeout  65;

    server {
        # Nixpacks sets PORT; we template it in via envsubst at start
        listen      ${PORT};
        server_name _;

        # Static site root (Nixpacks build copies ./app -> /var/www/html)
        root  /var/www/html;
        index index.html;

        # Main route: serve file or fall back to index.html
        location / {
            try_files $uri $uri/ /index.html;
        }

        # Cache static assets (optional)
        location ~* \.(css|js|png|jpg|jpeg|gif|svg|ico|webp)$ {
            expires 7d;
            add_header Cache-Control "public";
            try_files $uri $uri/ /index.html;
        }
    }
}

